{"version":3,"file":"index.umd.js","sources":["../lib/bufferCutter.js"],"sourcesContent":["export function cutBuffer(buf, opts) {\n  const { deepCopy = true, start, end } = opts;\n  const length = buf.length < end ? buf.length - start : end - start;\n\n  if (deepCopy) {\n    const result = Buffer.alloc(length);\n    buf.copy(result, 0, start, start + length);\n    return result;\n  }\n\n  return buf.subarray(start, start + length);\n}\n\nexport function cuttingBuffer(buffer, opts) {\n  const result = [];\n  const { length, deepCopy = true } = opts;\n\n  for (let i = 0; i < buffer.length; ) {\n    result.push(cutBuffer(buffer, { deepCopy, start: i, end: (i += length) }));\n  }\n\n  return result;\n}\n\nexport async function* cuttingRStream(readable, opts) {\n  const { length, deepCopy = true } = opts;\n\n  let tmpBuffers = [];\n  let tmpTotalSize = 0;\n  // eslint-disable-next-line no-restricted-syntax\n  for await (const chunk of readable) {\n    tmpBuffers.push(chunk);\n    tmpTotalSize += chunk.length;\n\n    if (tmpTotalSize > length) {\n      const buffers = cuttingBuffer(Buffer.concat(tmpBuffers), {\n        deepCopy,\n        length,\n      });\n      const isRest = buffers.length % length !== 0;\n      const loopTimes = isRest ? buffers.length - 1 : buffers.length;\n      for (let i = 0; i < loopTimes; i += 1) {\n        yield buffers[i];\n      }\n\n      if (isRest) {\n        tmpBuffers = [buffers[buffers.length - 1]];\n        tmpTotalSize = tmpBuffers.reduce((sum, buf) => sum + buf.length, 0);\n      } else {\n        tmpBuffers = [];\n        tmpTotalSize = 0;\n      }\n    }\n  }\n  if (tmpBuffers.length > 0) yield* tmpBuffers;\n}\n"],"names":["cutBuffer","buf","opts","deepCopy","start","end","length","result","Buffer","alloc","copy","subarray","cuttingBuffer","buffer","i","push","readable","tmpBuffers","tmpTotalSize","chunk","buffers","concat","loopTimes","isRest","reduce","sum"],"mappings":"6qDAAgBA,EAAUC,EAAKC,GAC7B,MAAwCA,EAAhCC,SAAiBC,EAAeF,EAAfE,MAAOC,EAAQH,EAARG,IAC1BC,EAASL,EAAIK,OAASD,EAAMJ,EAAIK,OAASF,EAAQC,EAAMD,EAE7D,iBAAc,CACZ,IAAMG,EAASC,OAAOC,MAAMH,GAE5B,OADAL,EAAIS,KAAKH,EAAQ,EAAGH,EAAOA,EAAQE,GAC5BC,EAGT,OAAON,EAAIU,SAASP,EAAOA,EAAQE,YAGrBM,EAAcC,EAAQX,GAIpC,IAHA,IAAMK,EAAS,GACPD,EAA4BJ,EAA5BI,SAA4BJ,EAApBC,SAAAA,gBAEPW,EAAI,EAAGA,EAAID,EAAOP,QACzBC,EAAOQ,KAAKf,EAAUa,EAAQ,CAAEV,SAAAA,EAAUC,MAAOU,EAAGT,IAAMS,GAAKR,KAGjE,OAAOC,kDAGF,WAA+BS,EAAUd,sHACtCI,EAA4BJ,EAA5BI,OAAQH,cAAoBD,EAApBC,aAEZc,EAAa,GACbC,EAAe,yBAEOF,kIANrB,GAOHC,EAAWF,KADII,QAEfD,GAAgBC,EAAMb,QAEHA,oBACXc,EAAUR,EAAcJ,OAAOa,OAAOJ,GAAa,CACvDd,SAAAA,EACAG,OAAAA,IAGIgB,GADAC,EAASH,EAAQd,OAASA,GAAW,GAChBc,EAAQd,OAAS,EAAIc,EAAQd,OAC/CQ,EAAI,eAAGA,EAAIQ,oBAClB,iBAAMF,EAAQN,GAlBf,QAiB8BA,GAAK,0BAIhCS,EAEFL,GADAD,EAAa,CAACG,EAAQA,EAAQd,OAAS,KACbkB,OAAO,SAACC,EAAKxB,UAAQwB,EAAMxB,EAAIK,QAAQ,IAEjEW,EAAa,GACbC,EAAe,GA1BhB,yTA8BDD,EAAWX,OAAS,oBAAG,2BAAOW,eA9B7B"}